{% load static %}

<div class="responsive-table">

    <table class="table table-bordered shadow-sm rounded bg-white">

        <!-- Encabezado -->
        <thead class="bg-white text-dark">

            <tr>
                <th colspan="3" class="text-center fs-4 fw-semibold">Carro de Compras</th>
            </tr>

            <tr>
                <th class="text-center">Producto</th>
                <th class="text-center">Cantidad</th>
                <th class="text-center">Precio</th>
            </tr>

        </thead>

        <!-- Cuerpo de la tabla -->
        <tbody>

            {% if request.session.carro.items %}
                {% for key, value in request.session.carro.items %}

                    <tr class="text-center align-middle">
                        <td>{{ value.nombre }}</td>
                        <td>{{ value.cantidad }}</td>
                        <td>
                            <!-- Botones de acción -->
                            <div class="d-inline-flex gap-2">
                                <a href="{% url 'carro:agregar' value.producto_id %}" class="btn btn-sm btn-outline-success">+</a>
                                <a href="{% url 'carro:restar' value.producto_id %}" class="btn btn-sm btn-outline-danger">-</a>
                            </div>

                            <!-- Precio -->
                            <div class="mt-2 fw-bold text-secondary">{{ value.precio | floatformat:2 }} €</div>

                        </td>
                    </tr>

                {% endfor %}
            {% else %}

                <tr>
                    <td colspan="3" class="text-center">
                        <div class="alert alert-warning m-0">Sin Productos</div>
                    </td>
                </tr>

            {% endif %}

        </tbody>

        <!-- Pie de tabla -->
        <tfoot>

            <tr class="bg-white">
                <td colspan="3" class="text-end fw-bold fs-5 text-secondary">
                    Total: {{ importe_total_carro | floatformat:2 }} €
                </td>
            </tr>

            {% if request.session.carro.items %}

                <tr>
                    <td colspan="3" class="text-center">
                        <button class="btn btn-primary" data-bs-target="#comprarModal_{{ usuario.id }}" data-bs-toggle="modal"> Comprar </button>
                    </td>
                </tr>

            {% endif %}
            {% if messages %}

                <tr>
                    <td colspan="3">
                        <ul class="messages list-unstyled mb-0">

                            {% for message in messages %}

                                <li {% if message.tags %} class="{{ message.tags }}"{% endif %}>
                                    <span class="mensaje-error-carrito">{{ message }}</span>
                                </li>

                            {% endfor %}

                        </ul>
                    </td>
                </tr>
            {% endif %}
        </tfoot>
    </table>
</div>
